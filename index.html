<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>Congress Debate</title>
 <style>
  body {
   font-family: Arial, sans-serif;
   margin: 20px;
  }
  table {
   width: 100%;
   border-collapse: collapse;
  }
  th, td {
   padding: 8px;
   text-align: left;
   border-bottom: 1px solid #ddd;
  }
  th {
   background-color: #f2f2f2;
  }
  h2 {
   margin-top: 30px;
  }
  .cycle-container {
   display: none;
  }
  .cycle-container.active {
   display: block;
  }
 </style>
</head>
<body>
 <h1>Congress Debate</h1>

 <form id="code-form">
  <label for="code-input">Enter codes (comma-separated):</label><br>
  <input type="text" id="code-input" name="code-input"><br><br>
  <button type="button" id="randomize-codes">Randomize Codes</button>
 </form>

 <!-- Container for all cycles -->
 <div id="cycles-container">
  <!-- Add more cycle containers for additional cycles -->
 </div>

 <!-- Container for speakers list -->
 <div id="speakers-list-container"></div>

 <!-- Lists of codes -->
 <div id="codes-lists">
  <div id="speeches-list">
    <h2>List of Codes Sorted by Least Speeches Given</h2>
    <ul id="least-speeches-list"></ul>
  </div>
  <div id="questions-list">
    <h2>List of Codes Sorted by Least Questions Asked</h2>
    <ul id="least-questions-list"></ul>
  </div>
 </div>

 <button id="add-row">Add Row</button>
 <button id="prev-cycle">Previous Cycle</button>
 <button id="next-cycle">Next Cycle</button>

 <script>
  // Wait for the DOM to be fully loaded before executing JavaScript code
  document.addEventListener('DOMContentLoaded', function() {
    var currentCycle = 1;
    var totalCycles = 6; // Change this value if you want more or fewer cycles
    var speakerOrder = {}; // Object to store randomized speaker order

    // Function to show/hide cycle containers based on current cycle
    function updateCycleVisibility() {
      for (var i = 1; i <= totalCycles; i++) {
        var cycleContainer = document.getElementById('cycle' + i);
        if (i === currentCycle) {
          cycleContainer.classList.add('active');
        } else {
          cycleContainer.classList.remove('active');
        }
      }
    }

    // Function to create a new cycle container with a table
    function createCycleContainer(cycleNumber) {
      var cycleContainer = document.createElement('div');
      cycleContainer.classList.add('cycle-container');
      cycleContainer.setAttribute('id', 'cycle' + cycleNumber);

      var cycleHeader = document.createElement('h2');
      cycleHeader.innerText = 'Cycle ' + cycleNumber;

      cycleContainer.appendChild(cycleHeader);

      // Create table
      var table = document.createElement('table');
      var tableRow = table.insertRow();
      var headers = ['Speaker (Affirmation)', 'Questioners (Affirmation)', 'Speaker (Negation)', 'Questioners (Negation)'];
      headers.forEach(function(headerText) {
        var headerCell = document.createElement('th');
        headerCell.innerText = headerText;
        tableRow.appendChild(headerCell);
      });

      // Add a row with empty cells to the table
      var tableRow = table.insertRow();
      for (var i = 0; i < headers.length; i++) {
        var cell = tableRow.insertCell();
        cell.innerText = '';
      }

      cycleContainer.appendChild(table);
      document.getElementById('cycles-container').appendChild(cycleContainer);
    }

    // Create cycle containers for all cycles
    for (var i = 1; i <= totalCycles; i++) {
      createCycleContainer(i);
    }

    // Initialize by showing the first cycle
    updateCycleVisibility();

    // Create speakers list divs
    var speakersListContainer = document.getElementById('speakers-list-container');
    for (var i = 1; i <= totalCycles; i++) {
      var speakersListDiv = document.createElement('div');
      speakersListDiv.classList.add('speakers-list');
      speakersListDiv.setAttribute('id', 'speakers-list' + i);
      speakersListContainer.appendChild(speakersListDiv);
    }

    // Function to update the table with speakers and questioners for a specific cycle
    function updateCycle(cycleNumber, speakerAffirmation, questionersAffirmation, speakerNegation, questionersNegation) {
      var cycleContainer = document.getElementById('cycle' + cycleNumber);
      var table = cycleContainer.querySelector('table');
      var lastRow = table.rows[table.rows.length - 1]; // Get the last row of the table
      lastRow.cells[0].innerText = speakerAffirmation;
      lastRow.cells[1].innerText = questionersAffirmation.join(', ');
      lastRow.cells[2].innerText = speakerNegation;
      lastRow.cells[3].innerText = questionersNegation.join(', ');
    }

    // Function to add a new row to the table
    document.getElementById('add-row').addEventListener('click', function() {
      var table = document.getElementById('cycle' + currentCycle).querySelector('table');
      var newRow = table.insertRow(-1); // Insert a row at the end of the table
      newRow.innerHTML = '<td></td><td></td><td></td><td></td>'; // Add empty cells to the new row
    });

    // Function to handle switching to the next cycle
    document.getElementById('next-cycle').addEventListener('click', function() {
      if (currentCycle < totalCycles) {
        currentCycle++;
        updateCycleVisibility();
      }
    });

    // Function to handle switching to the previous cycle
    document.getElementById('prev-cycle').addEventListener('click', function() {
      if (currentCycle > 1) {
        currentCycle--;
        updateCycleVisibility();
      }
    });

    // Function to randomize codes
    document.getElementById('randomize-codes').addEventListener('click', function() {
      var codesInput = document.getElementById('code-input').value;
      var codesArray = codesInput.split(',').map(function(code) {
        return code.trim();
      });

      // Randomize the codes
      for (var i = codesArray.length - 1; i > 0; i--) {
        var j = Math.floor(Math.random() * (i + 1));
        [codesArray[i], codesArray[j]] = [codesArray[j], codesArray[i]];
      }

      // Store randomized order of speakers
      speakerOrder[currentCycle] = codesArray;

      // Display order of speakers
      var speakersHtml = '<h2>Order of Speakers</h2><ul>';
      codesArray.forEach(function(code, index) {
        speakersHtml += '<li>' + code + ' ' +
          '<button type="button" class="btn-affirmation" data-code="' + code + '">Affirmation Speaker</button>' +
          '<button type="button" class="btn-negation" data-code="' + code + '">Negation Speaker</button>' +
          '<button type="button" class="btn-affirmation-q" data-code="' + code + '">Affirmation Questioner</button>' +
          '<button type="button" class="btn-negation-q" data-code="' + code + '">Negation Questioner</button>' +
          '</li>';
      });
      speakersHtml += '</ul>';
      document.getElementById('speakers-list' + currentCycle).innerHTML = speakersHtml; // Modified line to target the current cycle
      
      // Display list of codes sorted by least speeches given
      var leastSpeechesListHtml = '<h2>List of Codes Sorted by Least Speeches Given</h2><ul>';
      speakerOrder[currentCycle].forEach(function(code, index) {
        leastSpeechesListHtml += '<li>' + code + '</li>';
      });
      leastSpeechesListHtml += '</ul>';
      document.getElementById('least-speeches-list').innerHTML = leastSpeechesListHtml;
    });

    // Event listener for the buttons next to each code
    document.getElementById('speakers-list-container').addEventListener('click', function(event) {
      var code = event.target.getAttribute('data-code');
      var table = document.getElementById('cycle' + currentCycle).querySelector('table');
      var lastRow = table.rows[table.rows.length - 1]; // Get the last row of the table

      if (event.target.classList.contains('btn-affirmation')) {
        lastRow.cells[0].innerText += (lastRow.cells[0].innerText === '') ? code : ', ' + code;
        updateLeastSpeechesList();
      } else if (event.target.classList.contains('btn-negation')) {
        lastRow.cells[2].innerText += (lastRow.cells[2].innerText === '') ? code : ', ' + code;
        updateLeastSpeechesList();
      } else if (event.target.classList.contains('btn-affirmation-q')) {
        lastRow.cells[1].innerText += (lastRow.cells[1].innerText === '') ? code : ', ' + code;
      } else if (event.target.classList.contains('btn-negation-q')) {
        lastRow.cells[3].innerText += (lastRow.cells[3].innerText === '') ? code : ', ' + code;
      }
    });

    // Function to update the list of codes sorted by least speeches given
    function updateLeastSpeechesList() {
      var leastSpeechesListHtml = '<h2>List of Codes Sorted by Least Speeches Given</h2><ul>';
      var codesArray = speakerOrder[currentCycle].slice(); // Make a copy of the array
      var table = document.getElementById('cycle' + currentCycle).querySelector('table');
      for (var i = 0; i < table.rows.length; i++) {
        var cells = table.rows[i].cells;
        var speakerCodes = cells[0].innerText.split(', ');
        speakerCodes.forEach(function(code) {
          var index = codesArray.indexOf(code);
          if (index !== -1) {
            codesArray.splice(index, 1); // Remove the code from the array if found
          }
        });
      }
      codesArray.forEach(function(code) {
        leastSpeechesListHtml += '<li>' + code + '</li>';
      });
      leastSpeechesListHtml += '</ul>';
      document.getElementById('least-speeches-list').innerHTML = leastSpeechesListHtml;
    }
  });
 </script>
</body>
</html>
