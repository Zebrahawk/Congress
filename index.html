<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>Congress Debate</title>
 <style>
  body {
   font-family: Arial, sans-serif;
   margin: 20px;
  }
  table {
   width: 100%;
   border-collapse: collapse;
  }
  th, td {
   padding: 8px;
   text-align: left;
   border-bottom: 1px solid #ddd;
  }
  th {
   background-color: #f2f2f2;
  }
  h2 {
   margin-top: 30px;
  }
  .cycle-container {
   display: none;
  }
  .cycle-container.active {
   display: block;
  }
 </style>
</head>
<body>
 <h1>Congress Debate</h1>

 <form id="code-form">
  <label for="code-input">Enter codes (comma-separated):</label><br>
  <input type="text" id="code-input" name="code-input"><br><br>
  <button type="button" id="randomize-codes">Randomize Codes</button>
 </form>

 <!-- Container for all cycles -->
 <div id="cycles-container">
  <!-- Add more cycle containers for additional cycles -->
 </div>

 <!-- Container for speakers list -->
 <div id="speakers-list-container"></div>

 <button id="add-row">Add Row</button>
 <button id="prev-cycle">Previous Cycle</button>
 <button id="next-cycle">Next Cycle</button>

 <h1>Precedency</h1>
 <ul id="precedency-list"></ul>

 <script>
  // Wait for the DOM to be fully loaded before executing JavaScript code
document.addEventListener('DOMContentLoaded', function() {
    var currentCycle = 1;
    var totalCycles = 6; // Change this value if you want more or fewer cycles
    var speakerOrder = {}; // Object to store randomized speaker order
    var speechCount = {}; // Object to store the number of speeches and questions given by each code
    var codesArray = []; // Array to store randomized codes

    // Function to show/hide cycle containers based on current cycle
    function updateCycleVisibility() {
        for (var i = 1; i <= totalCycles; i++) {
            var cycleContainer = document.getElementById('cycle' + i);
            if (i === currentCycle) {
                cycleContainer.classList.add('active');
            } else {
                cycleContainer.classList.remove('active');
            }
        }
    }

    // Function to create a new cycle container with a table
    function createCycleContainer(cycleNumber) {
        var cycleContainer = document.createElement('div');
        cycleContainer.classList.add('cycle-container');
        cycleContainer.setAttribute('id', 'cycle' + cycleNumber);

        var cycleHeader = document.createElement('h2');
        cycleHeader.innerText = 'Cycle ' + cycleNumber;

        cycleContainer.appendChild(cycleHeader);

        // Create table
        var table = document.createElement('table');
        var tableRow = table.insertRow();
        var headers = ['Speaker (Affirmation)', 'Questioners (Affirmation)', 'Speaker (Negation)', 'Questioners (Negation)'];
        headers.forEach(function(headerText) {
            var headerCell = document.createElement('th');
            headerCell.innerText = headerText;
            tableRow.appendChild(headerCell);
        });

        // Add a row with empty cells to the table
        var tableRow = table.insertRow();
        for (var i = 0; i < headers.length; i++) {
            var cell = tableRow.insertCell();
            cell.innerText = '';
        }

        cycleContainer.appendChild(table);
        document.getElementById('cycles-container').appendChild(cycleContainer);
    }

    // Create cycle containers for all cycles
    for (var i = 1; i <= totalCycles; i++) {
        createCycleContainer(i);
    }

    // Initialize by showing the first cycle
    updateCycleVisibility();

    // Create speakers list divs
    var speakersListContainer = document.getElementById('speakers-list-container');
    for (var i = 1; i <= totalCycles; i++) {
        var speakersListDiv = document.createElement('div');
        speakersListDiv.classList.add('speakers-list');
        speakersListDiv.setAttribute('id', 'speakers-list' + i);
        speakersListContainer.appendChild(speakersListDiv);
    }

    // Function to update the table with speakers and questioners for a specific cycle
    function updateCycle(cycleNumber, speakerAffirmation, questionersAffirmation, speakerNegation, questionersNegation) {
        var cycleContainer = document.getElementById('cycle' + cycleNumber);
        var table = cycleContainer.querySelector('table');
        var lastRow = table.rows[table.rows.length - 1]; // Get the last row of the table
        lastRow.cells[0].innerText = speakerAffirmation;
        lastRow.cells[1].innerText = questionersAffirmation.join(', ');
        lastRow.cells[2].innerText = speakerNegation;
        lastRow.cells[3].innerText = questionersNegation.join(', ');
    }

    // Function to add a new row to the table
    document.getElementById('add-row').addEventListener('click', function() {
        var table = document.getElementById('cycle' + currentCycle).querySelector('table');
        var newRow = table.insertRow(-1); // Insert a row at the end of the table
        newRow.innerHTML = '<td></td><td></td><td></td><td></td>'; // Add empty cells to the new row
    });

    // Function to handle switching to the next cycle
    document.getElementById('next-cycle').addEventListener('click', function() {
        if (currentCycle < totalCycles) {
            currentCycle++;
            updateCycleVisibility();
        }
    });

    // Function to handle switching to the previous cycle
    document.getElementById('prev-cycle').addEventListener('click', function() {
        if (currentCycle > 1) {
            currentCycle--;
            updateCycleVisibility();
        }
    });

    // Function to randomize codes
    document.getElementById('randomize-codes').addEventListener('click', function() {
        var codesInput = document.getElementById('code-input').value;
        codesArray = codesInput.split(',').map(function(code) {
            return code.trim();
        });

        // Initialize speech count for each code to 0
        codesArray.forEach(function(code) {
            speechCount[code] = { speeches: 0, questions: 0 };
        });

        // Randomize the codes
        for (var i = codesArray.length - 1; i > 0; i--) {
            var j = Math.floor(Math.random() * (i + 1));
            [codesArray[i], codesArray[j]] = [codesArray[j], codesArray[i]];
        }

        // Store randomized order of speakers
        speakerOrder[currentCycle] = codesArray;

        // Sort the codes based on the number of speeches given and the randomized order
        codesArray.sort(customSort);

        // Display order of speakers
        var speakersHtml = '<h2>Order of Speakers</h2><ul>';
        codesArray.forEach(function(code, index) {
            speakersHtml += '<li>' + code + ' ' +
                '<button type="button" class="btn-affirmation" data-code="' + code + '">Affirmation Speaker</button>' +
                '<button type="button" class="btn-negation" data-code="' + code + '">Negation Speaker</button>' +
                '<button type="button" class="btn-affirmation-q" data-code="' + code + '">Affirmation Questioner</button>' +
                '<button type="button" class="btn-negation-q" data-code="' + code + '">Negation Questioner</button>' +
                '</li>';
        });
        speakersHtml += '</ul>';
        document.getElementById('speakers-list' + currentCycle).innerHTML = speakersHtml; // Modified line to target the current cycle

        // Display sorted codes in the Precedency list
        var precedencyList = document.getElementById('precedency-list');
        precedencyList.innerHTML = ''; // Clear previous entries
        codesArray.forEach(function(code) {
            var listItem = document.createElement('li');
            listItem.textContent = code;
            precedencyList.appendChild(listItem);
        });
    });

    // Custom sorting function
    function customSort(a, b) {
        // Compare based on the number of speeches given
        if (speechCount[a].speeches !== speechCount[b].speeches) {
            return speechCount[b].speeches - speechCount[a].speeches; // Sort in descending order of speeches
        } else {
            // If the number of speeches given is equal, use the order from the randomized list
            return speakerOrder[currentCycle].indexOf(a) - speakerOrder[currentCycle].indexOf(b);
        }
    }

    // Event listener for the buttons next to each code
    document.getElementById('speakers-list-container').addEventListener('click', function(event) {
        var code = event.target.getAttribute('data-code');
        var table = document.getElementById('cycle' + currentCycle).querySelector('table');
        var lastRow = table.rows[table.rows.length - 1]; // Get the last row of the table

        if (event.target.classList.contains('btn-affirmation')) {
            lastRow.cells[0].innerText += (lastRow.cells[0].innerText === '') ? code : ', ' + code;
        } else if (event.target.classList.contains('btn-negation')) {
            lastRow.cells[2].innerText += (lastRow.cells[2].innerText === '') ? code : ', ' + code;
        } else if (event.target.classList.contains('btn-affirmation-q')) {
            lastRow.cells[1].innerText += (lastRow.cells[1].innerText === '') ? code : ', ' + code;
            // Increment questions count for the code
            speechCount[code].questions++;
        } else if (event.target.classList.contains('btn-negation-q')) {
            lastRow.cells[3].innerText += (lastRow.cells[3].innerText === '') ? code : ', ' + code;
            // Increment questions count for the code
            speechCount[code].questions++;
        }

        // Increment speech count for the code
        if (event.target.classList.contains('btn-affirmation') || event.target.classList.contains('btn-negation')) {
            speechCount[code].speeches++;
        }
        console.log(speechCount); // Log the speech count for testing
    });
});
 </script>
</body>
</html>
